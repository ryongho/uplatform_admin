<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Admin - shiny-O</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>





<body>
    <div class="container-xxl position-relative  bg-light d-flex p-0" style="max-width:2000px;">

        <!-- Content Start -->
        <div class="content bg-white">
    
            <!-- Table Start -->
                    <div class="col-12 bg-white px-4 py-0" style="float:left;">
                        <div style="margin-top:80px;margin-bottom:40px;">
                            <button type="button" class="btn btn-lg btn-primary m-2">확정대기 300</button>
                            <button type="button" class="btn btn-lg btn-outline-secondary m-2">진행중 300</button>
                            <button type="button" class="btn btn-lg btn-outline-secondary m-2">완료 300</button>
                        </div>
                        <select class="form-select search_type mb-1" aria-label=".search_type" style="width:auto;float:left;margin-right:20px;">
                            <option selected="all">전체</option>
                            <option value="reservation_no">예약번호</option>
                            <option value="name">고객명</option>
                            <option value="email">이메일</option>
                            <option value="phone">전화번호</option>
                        </select>
                        <select class="form-select status mb-1" aria-label=".status" style="width:auto;float:left;margin-right:20px;">
                            <option selected="all">전체</option>
                            <option value="reservation_no">확정대기</option>
                            <option value="name">예약취소</option>
                        </select>
                        <input class="form-control border-1" type="search" placeholder="Search" style="width:50%;float:left;margin-right:20px;">
                        <button type="button" class="btn btn-outline-secondary m-2" style="width:auto;float:left;margin:0px;">검색</button>
                    </div>
            
                    <div class="col-12">
                        <div class="bg-white rounded h-100 p-4">
                            <h6 class="mb-4">신청 & 지원 현황</h6>
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">신청일시</th>
                                        <th scope="col">예약번호</th>
                                        <th scope="col">고객명</th>
                                        <th scope="col">서비스유형</th>
                                        <th scope="col">서비스상세</th>
                                        <th scope="col">방문주소</th> 
                                        <th scope="col">서비스 신청일시</th>
                                        <th scope="col">진행상태</th>
                                        <th scope="col">위생등급여부</th>
                                        <th scope="col">안내사항</th>
                                        <th scope="col">결제금액</th>
                                    </tr>
                                </thead>
                                <tbody id="data_table">
                                    
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    
                </div>
            </div>
            <!-- Table End -->


            <!-- Footer Start -->
            <div class="container-fluid pt-4 px-4">
                <div class="bg-light rounded-top p-4">
                    <div class="row">
                        <div class="col-12 col-sm-6 text-center text-sm-start">
                            &copy; <a href="#">shiny-O</a>, All Right Reserved. 
                        </div>
                        
                    </div>
                </div>
            </div>
            <!-- Footer End -->
        </div>
        <!-- Content End -->


        <!-- Back to Top -->
        <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/chart/chart.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.js"
  integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
  crossorigin="anonymous"></script>
  <script src="js/jquery.cookie.js"></script>

  <script>
    $().ready(function(){

        //console.log($.cookie('token'));
        //check_login();
      
        $.ajax({
          method: "GET",
          headers: {
            'Authorization': `Bearer 423|qeW4zBD3TRC0KfFGR4TL7kj6OKwnaYQSXniOmExx`,
          },
          url: "http://api.hi-shiny-o.com/api/admin/reservation/list",
          data: { reservation_type : 'CS',
                    type: 'W', 
                    status: 'W', 
                    start_no: '0', 
                    row: '10', 
                    start_date: '2021-02-04', 
                    end_date: '2022-02-04', 
                    search_type: 'name', 
                    search_keyword: '노용호', 
                }
        })
        .done(function(result) {
            const status = result.status;
            if(status == "200"){ 
                let html = '';
                //console.log(result.data[0].created_at);
                const data = result.data;
                
                for(var key in data) { 
                    
                    const created_at = toStringByFormatting(new Date(data[key]['created_at']));
                    html += '<tr><th><input type="checkbox" class="checks" value="'+data[key]['reservation_id']+'"></th>';
                    html += '<td>'+created_at+'</td>';
                    html += '<td>'+data[key]['reservation_no']+'</td>';
                    html += '<td>'+data[key]['name']+'('+data[key]['email']+')</td>';
                    html += '<td>'+type_to_str(data[key]['reservation_type'])+'</td>';
                    html += '<td>'+data[key]['service_detail']+'</td>';
                    html += '<td>'+data[key]['service_addr']+'</td>';
                    html += '<td>'+data[key]['service_date']+'('+data[key]['service_time']+')</td>';
                    html += '<td>'+status_to_str(data[key]['status'])+'</td>';
                    html += '<td>'+data[key]['created_at']+'</td>';
                    html += '<td>'+data[key]['memo']+'</td>';
                    html += '<td>'+data[key]['price']+'</td>';
                    html += '</tr>';
                }

              $("#data_table").html(html);
            }else{
              alert("데이터를 로드하지 못했습니다.");
            }
        });

    });


    const check_login = () => {
        if(!$.cookie('token')){
            alert("로그인 후 이용해주세요.");
            window.location.href = "index.html";
        }
    }

    const type_to_str = (reservation_type) => {
        if(reservation_type == "CS"){   
            return "음식점 위생관리";
        }else if(reservation_type == "CR"){   
            return "공간정리";
        }else if(reservation_type == "LC"){   
            return "정리교육";
        }else{
            return "";
        }
    }

    const status_to_str = (status) => {
        if(status == "W"){   
            return "대기";
        }else if(status == "R"){   
            return "예약완료";
        }else if(status == "S"){   
            return "서비스완료";
        }else if(status == "C"){   
            return "취소";
        }
    }

    function toStringByFormatting(source) { 
        const year = source.getFullYear(); 
        const month = leftPad(source.getMonth() + 1); 
        const day = leftPad(source.getDate());

        const hour = leftPad(source.getHours());
        const minute = leftPad(source.getMinutes());
        const secound = leftPad(source.getSeconds()); 
        
        const date = year+'-'+month+'-'+day+' '+hour+':'+minute+':'+secound;

        return date; 
    }

    function leftPad(value) { 
        if (value >= 10) { 
                return value; 
        } 
        return `0${value}`; 
    }



  </script>
</body>

</html>